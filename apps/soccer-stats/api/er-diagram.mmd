erDiagram
    %% User Management Layer
    USER ||--o{ TEAM_PLAYER : "plays for teams"
    USER ||--o{ TEAM_COACH : "coaches teams"
    TEAM ||--o{ TEAM_PLAYER : "has players"
    TEAM ||--o{ TEAM_COACH : "has coaches"
    TEAM ||--|| TEAM_CONFIGURATION : "has default settings"
    
    %% Team Configuration
    TEAM_CONFIGURATION ||--|| GAME_FORMAT : "default format"
    
    %% Existing Game Structure
    GAME_FORMAT ||--o{ GAME : "defines format"
    GAME ||--o{ GAME_TEAM : "participates"
    TEAM ||--o{ GAME_TEAM : "plays in"

    %% Game Events & Position Tracking
    EVENT_TYPE ||--o{ GAME_EVENT : "categorizes"
    GAME ||--o{ GAME_EVENT : "contains"
    GAME_EVENT ||--o{ GAME_EVENT : "parent of"

    GAME_TEAM ||--o{ GAME_EVENT : "performs"

    USER ||--o{ GAME_EVENT : "performs"
    
    %% Position Tracking Notes:
    %% - Game start: SUBSTITUTION_IN events for all starting players (no parent)
    %% - Regular subs: SUBSTITUTION_OUT -> SUBSTITUTION_IN (with parent relationship)
    %% - Position changes: New SUBSTITUTION_IN event (same player, new position)
    %% - Each GAME_EVENT includes position information when relevant

    